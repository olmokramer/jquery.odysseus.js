<!doctype html>
<html lang="en">
  <head>
    <title>Rearend Manager</title>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="style.css"/>
    <script src="jquery.js"></script>
    <script src="jquery.htmlClean.min.js"></script>

    <script language="javascript">

        function exec(cmd, two, three) {
            document.execCommand(cmd, two || false, three || false);
        }

        function getBrowserContainer() {
            return (navigator.userAgent.indexOf("Firefox")!=-1) ? "html" : "body";
        }

        $("*").click(function() {
            if (!document.activeElement.isContentEditable)
                return $("#stylingBar").hide();
        })

        $(document).ready(function() {
            $("body").find("[contenteditable='true']:empty").each(function() {
                $(this).html($(this).data("placeholder"));
                $(this).addClass("empty");
            })
            $("[contenteditable='true']").bind("keyup click", function() {
                if($(this).text() == $(this).data("placeholder")) {
                    $(this).html("");
                    $(this).removeClass("empty");
                }
            })
            $("[contenteditable='true']").focusout(function() {
                if($(this).text() == "") {
                    $(this).html($(this).data("placeholder"));
                    $(this).addClass("empty");
                }
            })

            $("[contenteditable='true']").bind("paste", function(e) {
                var self = $(this);
                setTimeout(function() {
                    var html = $(self).html();
                    var cleanHTML = $.htmlClean($(self).html().replace(/<\/div><div>/gi, "<br>"), {
                        allowedAttributes: ["href"],
                        format: true,
                        allowedTags: ["a", "p", "br", "b", "strong", "em", "ul", "li", "ol", "i", "s", "u"]});
                    $(self).html(cleanHTML);
                }, 0)
            });

        })

    $(window).mouseup(function() {

        var selection = window.getSelection();
        var range = selection.getRangeAt(0);
        var parentNode = $(selection.anchorNode.parentNode);
        var selectionPosition = range.getBoundingClientRect();
        var startOffset = range.startOffset;
        var endOffset = range.endOffset;
        var selectionLength = endOffset - startOffset;

        if (!document.activeElement.isContentEditable)
            $("#stylingBar").hide();

        if(selectionLength === 0)
            return $("#stylingBar").hide();

        $("#stylingBar").css({
            top: selectionPosition.top - 50 + $(getBrowserContainer()).scrollTop(),
            left: selectionPosition.left
        }).show();

    })
    </script>

  </head>
  <body>

  <div id="stylingBar">
      <a href="#style-bold" onclick="exec('Bold');"><b>B</b></a>
      <a href="#style-italic" onclick="exec('Italic');"><i>I</i></a>
      <a href="#style-underline" onclick="exec('Underline');"><u>U</u></a>
      <a href="#style-underline" onclick="exec('StrikeThrough');"><s>S</s></a>
<!--       <a href="#style-link" onclick="exec('CreateLink', false, 'http://nos.nl');">&lt;a&gt</a>
      <a href="#style-link" onclick="exec('Unlink', false, 'http://nos.nl');">&lt;a&gt</a>
 -->  </div>

    <div id="document-container">

        <div id="left-column" class="inline-block">
            <div id="avatar" class="imagePlaceholder imagePlaceholderSmall"></div>
            <small class="doc-lastsaved">last saved today 19:47</small>
            <h4 class="doc-title">Cras mattis consectetur purus sit amet fermentum.</h4>
            <ul id="doc-actions">
                <li>save</li>
                <li>publish</li>
                <li>delete</li>
            </ul>
        </div>
        <div id="right-column" class="inline-block">
<!--             <div class="imagePlaceholder"></div>
 -->            <h1 id="doc-title" contenteditable="true" class="input-field" data-placeholder="Title">Cras mattis consectetur purus sit amet fermentum.</h1>
            <h3 id="doc-title" contenteditable="true" class="input-field" data-placeholder="Written by">Wouter Vroege</h3>
            <article class="doc-textarea" contenteditable="true" class="input-field" data-placeholder="Body text">
                Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor. Aenean eu leo quam. Pellentesque ornare sem lacinia quam venenatis vestibulum. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Donec ullamcorper nulla non metus auctor fringilla.
                <p>
                Donec id elit non mi porta gravida at eget metus. Aenean eu leo quam. Pellentesque ornare sem lacinia quam venenatis vestibulum. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla. Cras mattis consectetur purus sit amet fermentum. Integer posuere erat a ante venenatis dapibus posuere velit aliquet. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.
                <p>
                Etiam porta sem malesuada magna mollis euismod. Sed posuere consectetur est at lobortis. Donec ullamcorper nulla non metus auctor fringilla. Sed posuere consectetur est at lobortis. Duis mollis, est non commodo luctus, nisi erat porttitor ligula, eget lacinia odio sem nec elit.

            </article>
        </div>
    </div>


  </body>
</html>